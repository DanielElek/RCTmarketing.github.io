<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RCT - Loading...</title>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-W3FKJL0QQ2"></script>
    <script>
        // --- CONFIGURATION ---
        const GA_MEASUREMENT_ID = 'G-W3FKJL0QQ2'; 

        // MAP LOCATIONS TO SPECIFIC APPLE LINKS
        const CAMPAIGN_URLS = {
            // --- GYÅR LOCATIONS ---
            'szechenyi': "https://apps.apple.com/app/apple-store/id6751210880?pt=128027164&ct=szechenyi&mt=8",

            // --- VIENNA LOCATIONS ---
            'wu_wien':   "https://apps.apple.com/app/apple-store/id6751210880?pt=128027164&ct=vienna_wu&mt=8",
            'tu_wien':   "https://apps.apple.com/app/apple-store/id6751210880?pt=128027164&ct=vienna_tu&mt=8",
            'uni_wien':  "https://apps.apple.com/app/apple-store/id6751210880?pt=128027164&ct=vienna_uni&mt=8",
            
            // --- FALLBACK ---
            'default':   "https://apps.apple.com/app/apple-store/id6751210880?pt=128027164&ct=general_fallback&mt=8"
        };

        // --- TRACKING LOGIC ---
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', GA_MEASUREMENT_ID);

        function getParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                loc: params.get('loc') || 'unknown',
                col: params.get('col') || 'unknown', // We still read 'col' from URL
                typ: params.get('type') || 'unknown'
            };
        }

        window.onload = function() {
            const p = getParams();
            
            // 1. Determine Destination
            const destination = CAMPAIGN_URLS[p.loc] || CAMPAIGN_URLS['default'];

            // 2. Send Data to Google
            gtag('event', 'guerilla_scan', {
                // These keys strictly match your new GA4 Event Parameters:
                'scan_location': p.loc,   
                'scan_copy':     p.col,      // Mapped URL 'col' -> GA4 'scan_copy'
                'scan_type':     p.typ,       
                
                'event_callback': () => { window.location.href = destination; }
            });

            // 3. Failsafe Redirect
            setTimeout(() => {
                window.location.href = destination;
            }, 500);
        };
    </script>
</head>
<body style="background-color: #000; color: #fff; font-family: sans-serif; text-align: center; padding-top: 50px;">
    <p>Loading App Store...</p>
</body>
</html>
